{{ include parts_html_header.html }}

<div class="showblock">
  <div>
    <h1>
      {{ $title | check_mudai }}
      {{if $is_private}}ğŸ”’{{endif}}
    </h1>
    <p class="memo">{{ $memo }}</p>
  </div>
  <div>
    <label>ãƒ—ãƒ­ã‚°ãƒ©ãƒ :<br />
    
    <textarea id="nako3code">{{ $body }}</textarea>
    </label><br />
    <button id="runButton" class="pure-button pure-button-primary">â–¶ã€€å®Ÿ è¡Œ</button>
    <button id="clearButton" class="pure-button">ã‚¯ãƒªã‚¢</button>
    <div id="runbox">
      <!-- 3.1.19ä»¥ä¸Š -->
      <div id="nako3_output"></div>

      <!-- 3.1.18ä»¥ä¸‹ -->
      <div id="nako3_error" style="display:none"></div> 
      <textarea class="nako3row nako3info" readonly
            id="nako3_info" rows="5" style="display:none"></textarea>
  
      <canvas id='nako3_canvas' width='{{$canvas_w}}' height='{{$canvas_h}}'></canvas>
      <div id='nako3_div' class='nako3_div'></div>
      <div>
        <span class="memo">
          Canvas:
          å¹… <input type="text" id="canvas_w" value="{{$canvas_w}}" size="3"> Ã—
          é«˜ <input type="text" id="canvas_h" value="{{$canvas_h}}" size="3">
        </span>
      </div>
    </div>
  </div>
  <ul class="devblock">
    {{if $app_id gt 0}}
    <li>
      <span>
        {{if $user_id gt 0}}
          <a href="index.php?action=list&user_id={{$user_id}}">
            <img src="{{$profile_url}}" width="48" height="48">
            {{ $author | check_nanasi }} ä½œ
          </a>
        {{else}}
          {{ $author | check_nanasi }} ä½œ
        {{endif}}
        {{ if $url }}
          (<a href="{{$url}}">é–¢é€£URL</a>)
        {{ endif }}
    </span></li>
    {{endif}}
    <li>åˆ©ç”¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³: {{ $version }}</li>
    {{if $app_id gt 0}}
    <li>
      æŠ•ç¨¿æ—¥æ™‚: {{ $ctime | datetime }}
      {{ if $ctime != $mtime }}
        (ç·¨é›†: {{$mtime | datetime}})
      {{ endif }}
    </li>
    {{endif}}
    {{if $is_private}}
    <li>ğŸ”’ éå…¬é–‹ã®æŠ•ç¨¿</li>
    {{endif}}
  </ul>
  {{if $app_id gt 0}}
  <div class="fav_block">
    <button id="fav_button" class="pure-button">æ°—ã«å…¥ã£ãŸ ğŸ˜‹</button>
    &nbsp;<span id="fav">{{ $fav | star }}</span>
  </div>
  <div class="fav_block">
    <a class="pure-button" href="https://twitter.com/share?url={{$n3s_baseurl}}/id.php?{{$app_id}}&text=@{{$author}}%20{{$title}}">Twitterã«æŠ•ç¨¿</a>
  </div>
  {{endif}}
</div>

<!-- ç·¨é›†ãƒœã‚¿ãƒ³ -->
<div class="ctrl_block">
  {{if $app_id == 0}}
    <p><button onclick="saveClick()" class="pure-button">æ–°è¦ä¿å­˜</button></p>
  {{else}}
    {{if n3s_is_login()}}
      {{if ($my_user_id === $user_id) || n3s_is_admin()}}
      <p><button onclick="saveClick()" class="pure-button">ç·¨é›†</button></p>
      {{endif}}
    {{endif}}
  {{endif}}
  {{ if n3s_is_login() }}
  <p><a href="index.php?action=upload" class="pure-button">ç´ æã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</a></p>
  {{ else }}
  <p><a href="index.php?action=login">ãƒ­ã‚°ã‚¤ãƒ³</a>ã™ã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚</p>
  {{ endif }}
</div>

{{ if $app_id gt 0 }}
<!-- URLã‚’è¡¨ç¤º -->
<div class="blogparts">
  {{ if $is_private }}
    {{ if $access_key != "" }}
    <span class="memo"><a href="{{$widget_url}}">â†’ä¸€æ™‚å…¬é–‹ç”¨ãƒ–ãƒ­ã‚°ãƒ‘ãƒ¼ãƒ„ã®URL</a>: </span><br>
    <input class="info_link" type="text" onclick="this.select()"
    value="{{$widget_url}}"><br>
    {{ endif }}
  {{ else }}
  <span class="memo">â†’ã“ã®ä½œå“ã®URL: </span><br>
  <input class="info_link" type="text" onclick="this.select()"
    value="{{$n3s_baseurl}}/id.php?{{$app_id}}"><br>
  <span class="memo">
    <a href="{{$widget_url}}">â†’ãƒ–ãƒ­ã‚°ãƒ‘ãƒ¼ãƒ„ã®URL</a>: </span><br>
  <input class="info_link" type="text" onclick="this.select()" value="{{$widget_tag}}"><br>
  <span class="memo">
    <a href="{{$widget_url_run}}">â†’ã‚¢ãƒ—ãƒªãƒšãƒ¼ã‚¸ã®URL</a>: </span><br>
  <input class="info_link" type="text" onclick="this.select()" value="{{$widget_url_run}}">
  {{ endif }}
</div>
{{ endif }}

{{if $app_id gt 0}}
<div class="ctrl_block" style="text-align:right;">
  <div class="memo">
    <a href="{{$badlink}}">é€šå ±ã£ã¦ä½•ï¼Ÿ</a>
    <span id="bad">-</span>&nbsp;
    <button id="bad_button" class="pure-button">é€šå ±</button>
  </div>
  <div>&nbsp;</div>
</div>
{{endif}}

<!-- script for nadesiko3 -->
{{ $import_nako | raw }}

<!-- script for nako3storage-->
<script type="text/javascript">
  //nako3storage_show.js ã‹ã‚‰å‚ç…§ã™ã‚‹å¤‰æ•°
  var setValue = function() { alert("ç¾åœ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚") }
  var getValue = function() { alert("ç¾åœ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚"); return "" }
  var editorObjects = null

  function setupEditor() {
      if (navigator.nako3 === undefined) {
          setTimeout(function() { setupEditor() }, 100);
          return
      }
      const nako3code = document.getElementById("nako3code")
      if (navigator.nako3.setupEditor) {
        // 3.1.17ä»¥ä¸Šãªã‚‰setupEditoré–¢æ•°ãŒå­˜åœ¨ã™ã‚‹ã€‚
        // textareaã‚’divã§ç½®æ›ã—ã¦ã‹ã‚‰ace editorã¨ã—ã¦ä½¿ã†ã€‚
        const div = document.createElement("div")
        div.id = "nako3code"
        const parent = nako3code.parentElement
        parent.removeChild(nako3code)
        parent.appendChild(div)
        div.dataset.nako3Resizable = "true"
        div.textContent = nako3code.value

        editorObjects = navigator.nako3.setupEditor("nako3code");
        editorObjects.editor.on("change", function(e) {
          localStorage["n3s_save_body"] = editorObjects.editor.getValue()
        })
        setValue = function(text) { editorObjects.editor.setValue(text) }
        getValue = function() { return editorObjects.editor.getValue() }
      } else {
        // 3.1.17æœªæº€ã®ã¨ãã¯textareaã§è¡¨ç¤ºã™ã‚‹ã€‚
        nako3code.addEventListener("change", function(e) {
          localStorage["n3s_save_body"] = nako3code.value
        })
        setValue = function(text) { nako3code.value = text }
        getValue = function(text) { return nako3code.value }
        return
      }
  }

  // nako3storage info
  const baseurl = "{{ $baseurl | safe }}";
  const editlink = "{{ $editlink  | safe }}";
  // nako3 program info
  const app_id = {{ $app_id }};
  const nako_version = "{{ $version }}" + ".0.0.0"
  const runbox_c = document.getElementById('runbox')
  runbox_c.style.display = 'none'
  // check modified
  setupEditor()
</script>
<script defer type="text/javascript"
  src="{{e:echo n3s_getURL('nako3storage_show.js', 'file', ['m'=>$mtime_nako3storage_show]);}}"></script>

{{ include parts_html_footer.html }}
